<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="tech.jiangtao.mybatis.mapper.OrderMapperCustom">
		
	<!-- 查询订单关联用户信息 -->
	<!-- 使用ResultType进行一对一查询输出 -->
	<select id="findOrdersUserList" resultType="ordersCustom">
		SELECT orders.*,user.username,user.sex FROM orders,USER WHERE orders.user_id = user.id
	</select>
	
	
	<!-- 查询订单关联用户信息 -->
	<!-- 使用ResultMap进行一对一查询输出 -->
	<resultMap type="orders" id="userListResultMap">
		<id column="id" property="id"/>
		<result column="user_id" property="user_id"/>
		<result column="number" property="number"/>
		<result column="createtime" property="createtime"/>
		<result column="note" property="note"/>
		<!-- 关联信息的映射 用于对关联信息映射到单个的pojo映射-->
			<association property="user" javaType="user">
				<id column="user_id" property="id"/>
				<result column="username" property="username"/>
				<result column="sex" property="sex"/>
			</association>
	</resultMap>
	<select id="findOrdersUserListResultMap" resultMap="userListResultMap">
		SELECT orders.*,user.username,user.sex FROM orders,USER WHERE orders.user_id = user.id
	</select>
	
	
	<!-- 查询订单-订单详情-关联用户信息 -->
	<!-- 使用ResultMap进行一对多查询输出 -->
	<!-- 订单信息 -->
	<!-- 用户信息 -->
	<!-- 订单详细信息 -->
	<resultMap type="orders" id="OrdersDetailListResultMap" extends="userListResultMap">
		<collection property="orderdetails" ofType="tech.jiangtao.mybatis.pojo.Orderdetail">
			<id column="orders_id" property="id"/>
			<result column="items_id" property="items_id"/>
			<result column="items_id" property="items_id"/>
		</collection>
	</resultMap>
	<select id="findOrderAndOrdersDetailListResultMap" resultMap="ordersDetailListResultMap">
					SELECT orders.*,
			         user.username,
			         user.sex,
			         orderdetail.id orderdetail_id,
			         orderdetail.items_num,
			         orderdetail.items_id
			FROM orders,USER,orderdetail
			WHERE orders.user_id = user.id
			        AND orders.id = orderdetail
	</select>
	
</mapper>